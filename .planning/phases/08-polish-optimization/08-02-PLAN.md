---
phase: 08-polish-optimization
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/global-error.tsx
  - src/app/(dashboard)/error.tsx
  - src/app/(dashboard)/guilds/[guildId]/error.tsx
  - src/components/offline-banner.tsx
  - src/app/layout.tsx
  - src/hooks/use-keyboard-shortcuts.ts
autonomous: true

must_haves:
  truths:
    - "Uncaught errors in dashboard routes show branded error page with Try Again button instead of crashing"
    - "Root-level errors show minimal error page with Refresh button"
    - "Offline state shows persistent yellow banner at top that auto-dismisses on reconnect"
    - "Ctrl+K / Cmd+K focuses the search input on any page with a search field"
  artifacts:
    - path: "src/app/global-error.tsx"
      provides: "Root-level catastrophic error boundary"
      exports: ["default"]
    - path: "src/app/(dashboard)/error.tsx"
      provides: "Dashboard-wide error boundary with retry"
      exports: ["default"]
    - path: "src/app/(dashboard)/guilds/[guildId]/error.tsx"
      provides: "Guild-specific error boundary"
      exports: ["default"]
    - path: "src/components/offline-banner.tsx"
      provides: "Offline detection banner"
      exports: ["OfflineBanner"]
    - path: "src/hooks/use-keyboard-shortcuts.ts"
      provides: "Global keyboard shortcuts hook"
      exports: ["useKeyboardShortcuts"]
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/offline-banner.tsx"
      via: "component import"
      pattern: "OfflineBanner"
---

<objective>
Create error boundaries at three levels (global, dashboard, guild), offline detection banner, and keyboard shortcuts hook.

Purpose: Error resilience and accessibility foundations — users see actionable error pages instead of crashes, know when offline, and can use keyboard shortcuts.
Output: Three error boundary files, offline banner component, keyboard shortcuts hook.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-polish-optimization/08-CONTEXT.md

@src/app/layout.tsx
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create error boundaries at three levels</name>
  <files>
    src/app/global-error.tsx
    src/app/(dashboard)/error.tsx
    src/app/(dashboard)/guilds/[guildId]/error.tsx
  </files>
  <action>
    All error boundaries must be 'use client' components.

    1. `src/app/global-error.tsx` — Root catastrophic errors:
       - Must render its own `<html>` and `<body>` tags (Next.js requirement for global-error)
       - Use inline hex colors (not Tailwind theme) since Tailwind may not be loaded: bg #1a1a1a, surface #2d2d2d, border #404040, accent #8B5CF6
       - Show: warning icon (SVG), "Application Error" heading, "A critical error occurred. Please refresh the page." message
       - Refresh button with accent-purple background that calls `reset()`
       - Log error to console with console.error in useEffect

    2. `src/app/(dashboard)/error.tsx` — Dashboard-wide errors:
       - Use Tailwind classes (bg-background, bg-surface, border-border, bg-accent-purple)
       - Center vertically and horizontally with flex
       - Show: warning triangle SVG icon (red-400), "Something went wrong" heading, error.message or fallback message
       - "Try Again" button with accent-purple background that calls `reset()`
       - "Go to Dashboard" link below button (href="/guilds")
       - Log error in useEffect

    3. `src/app/(dashboard)/guilds/[guildId]/error.tsx` — Guild-specific errors:
       - Same layout as dashboard error but with different messaging
       - Show: "Guild Error" heading, error.message or "Failed to load guild data"
       - "Try Again" button that calls `reset()`
       - "Back to Guilds" link (href="/guilds")
       - Log error in useEffect
  </action>
  <verify>
    - All three files exist and export default function
    - `npx tsc --noEmit` passes
    - global-error has html/body tags, other two use Tailwind
  </verify>
  <done>
    Three error boundaries created: global (inline styles), dashboard (Tailwind), guild (Tailwind). All show actionable messages with Try Again/Refresh buttons.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create offline banner and keyboard shortcuts</name>
  <files>
    src/components/offline-banner.tsx
    src/app/layout.tsx
    src/hooks/use-keyboard-shortcuts.ts
  </files>
  <action>
    1. Create `src/components/offline-banner.tsx`:
       - 'use client' component
       - useState for isOffline, initialize as false
       - useEffect: set initial state from `!navigator.onLine`, listen to window 'offline'/'online' events
       - Render: fixed top-0 left-0 right-0 z-50 yellow banner (bg-yellow-500/20, border-b border-yellow-500/50)
       - Content: warning triangle SVG + "You're offline. Changes won't sync until connection is restored."
       - Return null when online
       - Position it with md:left-64 to account for sidebar width (or left-0 for full width, since it's above everything)

    2. Update `src/app/layout.tsx`:
       - Import OfflineBanner
       - Add `<OfflineBanner />` inside Providers, BEFORE {children}
       - Keep all existing content

    3. Create `src/hooks/use-keyboard-shortcuts.ts`:
       - 'use client' hook
       - Listen for keydown on document
       - Ctrl+K / Cmd+K: e.preventDefault(), find `[data-search-input]` element, call .focus()
       - Escape is already handled by Headless UI Dialog — no need to implement
       - Clean up listener on unmount
       - Export useKeyboardShortcuts

    Note: The data-search-input attribute will be added to SearchInput in Plan 08. The hook can be wired into the dashboard layout in Plan 08 as well. For now, just create the hook.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - OfflineBanner component exports correctly
    - useKeyboardShortcuts hook exports correctly
    - layout.tsx imports and renders OfflineBanner
  </verify>
  <done>
    Offline banner shows persistent yellow warning when navigator.onLine is false, auto-dismisses on reconnect. Keyboard shortcuts hook created for Ctrl+K search focus (will be wired in Plan 08).
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run build` succeeds
- Three error boundary files exist at correct paths
- OfflineBanner renders in root layout
- useKeyboardShortcuts hook created and typed correctly
</verification>

<success_criteria>
- Error boundaries catch errors at global, dashboard, and guild levels with styled UI and reset buttons
- Offline banner appears when browser goes offline, disappears on reconnect
- Keyboard shortcuts hook ready for Ctrl+K integration
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-polish-optimization/08-02-SUMMARY.md`
</output>
