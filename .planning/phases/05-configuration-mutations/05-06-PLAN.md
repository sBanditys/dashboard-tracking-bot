---
phase: 05-configuration-mutations
plan: 06
type: execute
wave: 3
depends_on: ["05-01", "05-05"]
files_modified:
  - src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx
  - src/app/(dashboard)/guilds/[guildId]/brands/page.tsx
  - src/components/tracking/account-card.tsx
autonomous: true

must_haves:
  truths:
    - "Accounts page has Add Account button that opens modal"
    - "Account cards have Delete button that shows confirmation"
    - "Brands page has Add Brand button that opens modal"
    - "Delete confirmation uses modal pattern"
  artifacts:
    - path: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      provides: "Accounts page with add/delete functionality"
      contains: "AddAccountModal"
    - path: "src/app/(dashboard)/guilds/[guildId]/brands/page.tsx"
      provides: "Brands page with add/delete functionality"
      contains: "AddBrandModal"
    - path: "src/components/tracking/account-card.tsx"
      provides: "Account card with delete action"
      contains: "ConfirmationModal"
  key_links:
    - from: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      to: "AddAccountModal"
      via: "modal state management"
      pattern: "useState.*showAddModal"
    - from: "src/components/tracking/account-card.tsx"
      to: "useDeleteAccount"
      via: "mutation hook usage"
      pattern: "useDeleteAccount"
---

<objective>
Wire up add and delete functionality to the tracking data pages.

Purpose: Connect the components from Plans 01 and 05 to the existing tracking pages, enabling users to add new accounts/brands and delete existing ones with confirmation dialogs.

Output: Accounts and Brands pages with Add buttons, Account cards with Delete buttons and confirmation modals.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-configuration-mutations/05-CONTEXT.md

# Dependencies from prior plans
@src/components/ui/confirmation-modal.tsx
@src/components/forms/add-account-modal.tsx
@src/components/forms/add-brand-modal.tsx
@src/hooks/use-guilds.ts

# Existing pages and components to modify
@src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx
@src/app/(dashboard)/guilds/[guildId]/brands/page.tsx
@src/components/tracking/account-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Delete to Account Card</name>
  <files>src/components/tracking/account-card.tsx</files>
  <action>
Update AccountCard to include a delete button and confirmation modal.

**Add imports:**
```typescript
import { useState } from 'react'
import { ConfirmationModal } from '@/components/ui/confirmation-modal'
import { useDeleteAccount } from '@/hooks/use-guilds'
```

**Update props to include guildId:**
```typescript
interface AccountCardProps {
  account: Account
  guildId: string  // Add this
}
```

**Add state and mutation in component:**
```typescript
const [showDeleteModal, setShowDeleteModal] = useState(false)
const deleteMutation = useDeleteAccount(guildId)

const handleDelete = async () => {
  try {
    await deleteMutation.mutateAsync(account.id)
    setShowDeleteModal(false)
  } catch {
    // Error is displayed in modal
  }
}
```

**Add delete button to card:**
In the card header or actions area, add:
```tsx
<button
  onClick={() => setShowDeleteModal(true)}
  className="text-red-500 hover:text-red-400 text-sm"
>
  Delete
</button>
```

**Add confirmation modal at the end of the component return:**
```tsx
<ConfirmationModal
  open={showDeleteModal}
  onClose={() => setShowDeleteModal(false)}
  onConfirm={handleDelete}
  title="Delete Account"
  itemName={`@${account.username}`}
  isLoading={deleteMutation.isPending}
/>
```

Position the delete button appropriately - either in the card header next to username, or as part of an actions row at the bottom of the card.
  </action>
  <verify>
TypeScript compilation passes: `npx tsc --noEmit`. AccountCard accepts guildId prop and renders delete button.
  </verify>
  <done>
AccountCard has delete button with confirmation modal using useDeleteAccount mutation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Up Accounts Page</name>
  <files>src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx</files>
  <action>
Update Accounts page to:
1. Pass guildId to AccountCard
2. Add "Add Account" button that opens modal

**Add imports:**
```typescript
import { useState } from 'react'
import { AddAccountModal } from '@/components/forms/add-account-modal'
```

**Add state:**
```typescript
const [showAddModal, setShowAddModal] = useState(false)
```

**Add "Add Account" button in the page header:**
Look for the existing page header section (probably with title "Accounts" or similar) and add:
```tsx
<button
  onClick={() => setShowAddModal(true)}
  className="px-4 py-2 bg-accent-purple hover:bg-accent-purple/80 text-white text-sm rounded-lg transition-colors"
>
  Add Account
</button>
```

**Add modal at the end of the return:**
```tsx
<AddAccountModal
  open={showAddModal}
  onClose={() => setShowAddModal(false)}
  guildId={guildId}
/>
```

**Update AccountCard usage:**
Wherever AccountCard is rendered, add the guildId prop:
```tsx
<AccountCard account={account} guildId={guildId} />
```
  </action>
  <verify>
TypeScript compilation passes: `npx tsc --noEmit`. Page has Add Account button and passes guildId to AccountCard.
  </verify>
  <done>
Accounts page has Add Account button and modal, AccountCard receives guildId for delete.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire Up Brands Page</name>
  <files>src/app/(dashboard)/guilds/[guildId]/brands/page.tsx</files>
  <action>
Update Brands page to:
1. Add "Add Brand" button that opens modal
2. Add delete functionality to brand items (if displayed as cards/rows)

**Add imports:**
```typescript
import { useState } from 'react'
import { AddBrandModal } from '@/components/forms/add-brand-modal'
import { ConfirmationModal } from '@/components/ui/confirmation-modal'
import { useDeleteBrand } from '@/hooks/use-guilds'
```

**Add state:**
```typescript
const [showAddModal, setShowAddModal] = useState(false)
const [brandToDelete, setBrandToDelete] = useState<{ id: string; label: string } | null>(null)
const deleteMutation = useDeleteBrand(guildId)
```

**Add "Add Brand" button in page header:**
```tsx
<button
  onClick={() => setShowAddModal(true)}
  className="px-4 py-2 bg-accent-purple hover:bg-accent-purple/80 text-white text-sm rounded-lg transition-colors"
>
  Add Brand
</button>
```

**Add delete button to each brand item:**
In the brand rendering section (likely a map over brands), add a delete button:
```tsx
<button
  onClick={() => setBrandToDelete({ id: brand.id, label: brand.label })}
  className="text-red-500 hover:text-red-400 text-sm"
>
  Delete
</button>
```

**Add modals at end of return:**
```tsx
<AddBrandModal
  open={showAddModal}
  onClose={() => setShowAddModal(false)}
  guildId={guildId}
/>

<ConfirmationModal
  open={!!brandToDelete}
  onClose={() => setBrandToDelete(null)}
  onConfirm={async () => {
    if (brandToDelete) {
      await deleteMutation.mutateAsync(brandToDelete.id)
      setBrandToDelete(null)
    }
  }}
  title="Delete Brand"
  itemName={brandToDelete?.label ?? ''}
  isLoading={deleteMutation.isPending}
/>
```

Note: The brands page may display brands differently than accounts. Adapt the delete button placement based on the existing UI structure (likely a list or grid of brand cards).
  </action>
  <verify>
TypeScript compilation passes: `npx tsc --noEmit`. Page has Add Brand button and delete functionality.
  </verify>
  <done>
Brands page has Add Brand button, modal, and delete functionality with confirmation.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes without errors
2. Accounts page shows "Add Account" button that opens AddAccountModal
3. Account cards have delete button that opens ConfirmationModal
4. Brands page shows "Add Brand" button that opens AddBrandModal
5. Brand items have delete functionality with confirmation
6. After add/delete, lists refresh automatically (cache invalidation working)
</verification>

<success_criteria>
- AccountCard accepts guildId and has delete button with ConfirmationModal
- Accounts page has Add Account button and AddAccountModal
- Brands page has Add Brand button, AddBrandModal, and delete with ConfirmationModal
- All modals open/close correctly
- Mutations trigger cache invalidation and lists refresh
</success_criteria>

<output>
After completion, create `.planning/phases/05-configuration-mutations/05-06-SUMMARY.md`
</output>
