---
phase: 13-alert-import-management
plan: 06
type: execute
wave: 4
depends_on: ["13-05"]
files_modified:
  - src/app/(dashboard)/guilds/[guildId]/manage/data/page.tsx
  - src/components/import-export/export-tab.tsx
  - src/components/import-export/export-type-selector.tsx
  - src/components/import-export/export-history-list.tsx
autonomous: true
requirements: [IMPEX-01]

must_haves:
  truths:
    - "Admin can select export type from radio cards with icons and descriptions"
    - "Admin can choose export format (CSV, XLSX, JSON)"
    - "Admin can filter exports by brand, group, platform"
    - "Admin sees preview count before downloading"
    - "Admin sees real-time progress bar during export generation"
    - "Export history shows all exports with re-download links and expiry badges"
    - "Remaining daily quota displayed near export button"
    - "GDPR export shown in separate section"
  artifacts:
    - path: "src/components/import-export/export-tab.tsx"
      provides: "Complete export flow: type selection, filters, preview, progress, history"
      exports: ["ExportTab"]
    - path: "src/components/import-export/export-type-selector.tsx"
      provides: "Radio card grid for export type selection"
      exports: ["ExportTypeSelector"]
    - path: "src/components/import-export/export-history-list.tsx"
      provides: "Export history with type badge, format, re-download, expiry"
      exports: ["ExportHistoryList"]
  key_links:
    - from: "src/components/import-export/export-tab.tsx"
      to: "src/hooks/use-exports.ts"
      via: "useCreateExport, useExportHistory, useExportProgress"
      pattern: "useCreateExport|useExportHistory|useExportProgress"
    - from: "src/app/(dashboard)/guilds/[guildId]/manage/data/page.tsx"
      to: "src/components/import-export/export-tab.tsx"
      via: "Tab content rendering"
      pattern: "ExportTab"
---

<objective>
Build the export tab with type selection radio cards, format selector, filters, preview count, real-time progress, export history, quota display, and GDPR section.

Purpose: Enable admins to export all data types (accounts, posts, metrics, analytics, audit, GDPR) in multiple formats with full progress tracking.

Output: Export tab fully functional within the data management page.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-alert-import-management/13-RESEARCH.md
@.planning/phases/13-alert-import-management/13-01-SUMMARY.md
@.planning/phases/13-alert-import-management/13-02-SUMMARY.md
@.planning/phases/13-alert-import-management/13-05-SUMMARY.md

Key reference files:
@src/hooks/use-exports.ts (existing export hooks — useCreateExport, useExportHistory, useExportProgress)
@src/types/export.ts (expanded types from Plan 01)
@src/components/export/export-config-form.tsx (existing export form — can reference but building new)
@src/components/export/export-history-table.tsx (existing export history — will be replaced/extended)
@src/app/(dashboard)/guilds/[guildId]/manage/data/page.tsx (from Plan 05)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create export type selector and export history list components</name>
  <files>
    src/components/import-export/export-type-selector.tsx
    src/components/import-export/export-history-list.tsx
  </files>
  <action>
  **Create `src/components/import-export/export-type-selector.tsx`:**

  A `'use client'` component for selecting export type using radio cards (locked decision: radio cards with icon and description per type).

  Props: `selected: ExportDataType | null`, `onSelect: (type: ExportDataType) => void`

  Export types (6 total, per locked decisions — 5 standard + 1 GDPR separate):
  1. **Accounts** — icon: `Users` (lucide), description: "Export tracked accounts with platform and group info"
  2. **Posts** — icon: `FileText`, description: "Export captured posts with metrics and timestamps"
  3. **Metrics** — icon: `BarChart3`, description: "Export performance metrics by account and platform"
  4. **Analytics** — icon: `TrendingUp`, description: "Export analytics summaries and trend data"
  5. **Audit** — icon: `Shield`, description: "Export audit log entries for compliance"

  GDPR export is rendered separately (see ExportTab).

  Radio card styling: Grid layout `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3`. Each card:
  - Default: `border border-border rounded-lg p-4 cursor-pointer hover:border-gray-500 transition-colors`
  - Selected: `border-accent-purple bg-accent-purple/10` (same radio-card pattern as existing export format selector)
  - Contains: icon (24px, muted color, purple when selected), type name (bold), description (muted text, small)
  - Keyboard accessible: each card is a `<button>` with `role="radio"` in a `role="radiogroup"` container

  Mobile (locked decision: Claude decides — use stack): On small screens, cards stack to single column.

  **Create `src/components/import-export/export-history-list.tsx`:**

  A `'use client'` component showing export history across all types (locked decision: shared list with type badge, date, format, row count, re-download link).

  Props: `guildId: string`

  Uses `useExportHistory(guildId, page)` hook.

  Each entry shows:
  - **Type badge:** colored pill showing data type (accounts/posts/metrics/etc.)
  - **Date:** formatted date string
  - **Format:** CSV/XLSX/JSON badge
  - **Row count:** number of records
  - **Status:** badge (pending=yellow, processing=blue, completed=green, failed=red, expired=gray)
  - **Re-download link:** if status=completed and not expired, show download button/link
  - **Expiry display** (locked decision): show "Expires in Xh" or "Expired" badge. Calculate from `expiresAt` field. Use `formatDistanceToNow` for relative time. If expired, show red "Expired" badge.

  Pagination: 20 items per page with prev/next buttons (locked decision: paginated, not infinite scroll).

  Empty state: "No exports yet" with subtle icon.

  Layout: Card-based on mobile, table-like on desktop using responsive grid.
  </action>
  <verify>
  `npx tsc --noEmit` passes.
  Files exist: `export-type-selector.tsx`, `export-history-list.tsx`.
  Grep for `role="radiogroup"` in export-type-selector confirms accessibility.
  Grep for `ExportDataType` confirms all 5 standard types (GDPR separate).
  Grep for `useExportHistory` in export-history-list confirms data fetching.
  Grep for `Expires` or `expiresAt` confirms expiry display.
  </verify>
  <done>
  Export type selector shows 5 radio cards with icons, descriptions, and keyboard accessibility. Export history list shows paginated entries with type badge, format, row count, re-download link, and expiry display.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build export tab with filters, preview, progress, quota, and GDPR section</name>
  <files>
    src/components/import-export/export-tab.tsx
    src/app/(dashboard)/guilds/[guildId]/manage/data/page.tsx
  </files>
  <action>
  **Create `src/components/import-export/export-tab.tsx`:**

  A `'use client'` component for the complete export experience.

  Props: `guildId: string`

  Uses hooks: `useCreateExport`, `useExportHistory`, `useExportProgress`, `useExportStatus` from `@/hooks/use-exports`.

  Layout from top to bottom:

  1. **Remaining quota display** (locked decision): Show "X of 10 exports remaining today" near the export button area. This data should come from the export history response or a separate quota endpoint. If the backend doesn't provide quota info, estimate from today's export count in history.

  2. **Export type selector:** Render `<ExportTypeSelector>` for the 5 standard types.

  3. **Format selector** (locked decision: dropdown): Headless UI Listbox with options: CSV, XLSX, JSON. Default to CSV.

  4. **Filter dropdowns** (locked decision: 3 filters — brand, group, platform):
     - Brand dropdown: fetch brands from existing `/api/guilds/${guildId}/brands` endpoint (use `useBrands` hook if available, or create inline query)
     - Group dropdown: depends on selected brand, shows account groups
     - Platform dropdown: 5 platforms + "All"
     - Note: these are type-specific filters (Claude's discretion: show only relevant filters per export type — accounts uses all 3, posts uses brand+platform, metrics/analytics use platform only, audit has no filters)

  5. **Preview count** (locked decision): Display "X records match your filters" above the export button. Show a few sample rows in a compact table. This requires a lightweight count/preview API call or estimation from existing data hooks.
     - If preview data not available from API, show the count from the data hooks (e.g., accounts count from existing query) as an estimate
     - Empty state: When 0 records match, disable export button (locked decision)

  6. **Export button:** "Export {N} {type} as {format}" with purple accent styling. Disabled when: no type selected, 0 records match, or quota exhausted.

  7. **Progress section:** When export is in progress, show:
     - Progress bar (animated, purple) with percentage
     - Cancel button (locked decision)
     - Record count: "X/{total} exported"
     - SSE progress via `useExportProgress`
     - On error: bar turns red + error message + "Try again" button (locked decision)

  8. **GDPR section** (locked decision: separate section with privacy messaging):
     - Visually distinct area below the standard exports
     - Title: "GDPR Data Export" with privacy shield icon
     - Description: "Export personal data in compliance with GDPR regulations. This includes all tracked data for the guild."
     - Separate quota display: "X of 3 GDPR exports remaining today"
     - Single "Export GDPR Data" button with format selector (same 3 options)
     - Same progress bar pattern when in progress

  9. **Export history** (locked decision: shared list across all types):
     - Render `<ExportHistoryList guildId={guildId} />` at the bottom

  Export flow:
  1. User selects type → format → filters
  2. Preview count updates
  3. User clicks export button
  4. `useCreateExport` mutation fires with `{ dataType, format, mode: 'all', filters }`
  5. On success: track the new export ID
  6. `useExportProgress(guildId, exportId)` streams SSE updates
  7. On complete: show download link, invalidate history
  8. On error: red progress bar + try again

  Loading state (locked decision: progressive load): Show export type selector and format selector immediately (static UI). History and quota load inline with skeleton/loading indicators.

  **Update `src/app/(dashboard)/guilds/[guildId]/manage/data/page.tsx`:**

  Replace the "Export tab coming soon" placeholder with `<ExportTab guildId={guildId} />`.

  Ensure the tab slide transition works correctly for both Import and Export tabs.
  </action>
  <verify>
  `npx tsc --noEmit` passes.
  Files exist: `export-tab.tsx`.
  Data page renders both Import and Export tabs.
  Grep for `useCreateExport` in export-tab confirms export creation.
  Grep for `useExportProgress` confirms SSE progress tracking.
  Grep for `GDPR` or `gdpr` confirms separate GDPR section.
  Grep for `remaining` or `quota` confirms quota display.
  Grep for `ExportTab` in data/page.tsx confirms integration.
  </verify>
  <done>
  Export tab has: type selector radio cards, format dropdown, 3 filter dropdowns (context-aware per type), preview count, export button with quota check, SSE progress bar with cancel, GDPR separate section with privacy messaging, export history with re-download and expiry badges. All integrated into the data page.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Export type selector shows 5 radio cards (GDPR separate)
- Format dropdown offers CSV/XLSX/JSON
- Filters are context-aware per export type
- Preview count updates when filters change
- Export button disabled when 0 results or quota exhausted
- SSE progress bar shows during export
- GDPR section has separate UI with privacy messaging
- Export history shows all exports with re-download and expiry
- Quota display shows remaining exports
</verification>

<success_criteria>
1. Radio cards for 5 export types with icons and descriptions
2. Format dropdown with CSV/XLSX/JSON options
3. Context-aware filter dropdowns per export type
4. Preview count shown before export
5. Export button disabled on 0 results or quota exhausted
6. Real-time SSE progress bar during export
7. Cancel button on progress bar
8. Error state with red bar + "Try again"
9. GDPR separate section with privacy messaging and 3/day quota
10. Export history with type badge, re-download link, expiry display
11. Progressive loading (static UI first, data loads inline)
</success_criteria>

<output>
After completion, create `.planning/phases/13-alert-import-management/13-06-SUMMARY.md`
</output>
