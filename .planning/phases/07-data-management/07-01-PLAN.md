---
phase: 07-data-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/export.ts
  - src/types/bulk.ts
  - src/hooks/use-selection.ts
  - src/components/ui/type-to-confirm-modal.tsx
autonomous: true

must_haves:
  truths:
    - "Export and bulk operation types are available for all downstream components"
    - "useShiftSelection hook supports checkbox toggle, shift-click range, select-all, and clear"
    - "TypeToConfirmModal requires user to type exact text before enabling confirm button"
  artifacts:
    - path: "src/types/export.ts"
      provides: "Export types (ExportFormat, ExportMode, ExportRequest, ExportRecord, ExportHistoryResponse)"
      contains: "ExportFormat"
    - path: "src/types/bulk.ts"
      provides: "Bulk operation types (BulkOperationResult, BulkDeleteRequest, BulkReassignRequest)"
      contains: "BulkOperationResult"
    - path: "src/hooks/use-selection.ts"
      provides: "useShiftSelection hook with shift-click range selection"
      contains: "useShiftSelection"
    - path: "src/components/ui/type-to-confirm-modal.tsx"
      provides: "Type-to-confirm modal for destructive bulk operations"
      contains: "TypeToConfirmModal"
  key_links:
    - from: "src/hooks/use-selection.ts"
      to: "src/types/tracking.ts"
      via: "Generic type parameter for selectable items"
      pattern: "useShiftSelection"
    - from: "src/components/ui/type-to-confirm-modal.tsx"
      to: "@headlessui/react"
      via: "Dialog component"
      pattern: "Dialog"
---

<objective>
Create the foundational types, selection hook, and type-to-confirm modal needed by all Phase 7 features.

Purpose: Every downstream plan depends on shared types (export, bulk operations) and the selection/confirmation patterns. Building these first enables parallel work on backend and UI.
Output: Export types, bulk operation types, useShiftSelection hook, TypeToConfirmModal component.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-management/07-CONTEXT.md
@.planning/phases/07-data-management/07-RESEARCH.md
@src/types/tracking.ts
@src/components/ui/confirmation-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Export and bulk operation types</name>
  <files>src/types/export.ts, src/types/bulk.ts</files>
  <action>
Create `src/types/export.ts` with these types:
- `ExportFormat = 'csv' | 'json' | 'xlsx'`
- `ExportMode = 'current_view' | 'all'`
- `ExportStatus = 'pending' | 'processing' | 'completed' | 'failed'`
- `ExportRequest` interface: `{ format: ExportFormat, mode: ExportMode, dataType: 'accounts' | 'posts', filters?: Record<string, string>, filename?: string }`
- `ExportRecord` interface: `{ id: string, format: ExportFormat, dataType: 'accounts' | 'posts', status: ExportStatus, filename: string, recordCount: number | null, progress: number, downloadUrl: string | null, expiresAt: string | null, errorMessage: string | null, createdAt: string, completedAt: string | null }`
- `ExportHistoryResponse` interface: `{ exports: ExportRecord[], pagination: { page: number, limit: number, total: number } }`
- `ExportProgressEvent` interface: `{ progress: number, status: ExportStatus, recordCount: number, message?: string }`

Create `src/types/bulk.ts` with these types:
- `BulkOperationResult` interface: `{ total: number, succeeded: number, failed: number, results: Array<{ id: string, status: 'success' | 'error', error?: string }> }`
- `BulkDeleteRequest` interface: `{ ids: string[], dataType: 'accounts' | 'posts' }`
- `BulkReassignRequest` interface: `{ ids: string[], dataType: 'accounts', targetBrandId: string, targetGroupId?: string }`
- `BulkExportRequest` interface: `{ ids: string[], dataType: 'accounts' | 'posts', format: ExportFormat }`

Import ExportFormat from export.ts in bulk.ts.
  </action>
  <verify>Run `npx tsc --noEmit` from the dashboard root. No type errors.</verify>
  <done>All export and bulk operation types compile and are importable from their respective files.</done>
</task>

<task type="auto">
  <name>Task 2: useShiftSelection hook</name>
  <files>src/hooks/use-selection.ts</files>
  <action>
Create `src/hooks/use-selection.ts` implementing a generic selection hook.

The hook signature: `useShiftSelection<T extends { id: string }>(items: T[])`

Returns:
- `selectedIds: Set<string>` - currently selected item IDs
- `handleSelect: (id: string, index: number, event: React.MouseEvent) => void` - toggle or shift-select
- `selectAllVisible: () => void` - select all items in current list
- `clearSelection: () => void` - deselect everything
- `isAllVisibleSelected: boolean` - true if all visible items selected
- `selectedCount: number` - count of selected items

Implementation details per RESEARCH.md pitfall 3 (race condition prevention):
- Track `lastSelectedId` (NOT index) using useState to avoid shift-click range bugs on reorder
- On shift-click: find lastSelectedId's current index in items array, then select range between that index and clicked index
- On regular click: toggle single item
- When items array changes (e.g., filter/sort), do NOT clear selection — but lastSelectedId's index lookup handles reorder gracefully
- If lastSelectedId is no longer in items (filtered out), treat shift-click as regular click

Use `useCallback` for handleSelect to prevent unnecessary re-renders. Use `useMemo` for isAllVisibleSelected and selectedCount.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>useShiftSelection hook compiles, exports correctly, handles single click, shift-click range, select-all, and clear.</done>
</task>

<task type="auto">
  <name>Task 3: TypeToConfirmModal component</name>
  <files>src/components/ui/type-to-confirm-modal.tsx</files>
  <action>
Create `src/components/ui/type-to-confirm-modal.tsx` — a modal that requires the user to type a specific confirmation text before the action button is enabled.

Per user decision: type-to-confirm pattern for ALL bulk operations (delete, reassign, export).

Props interface `TypeToConfirmModalProps`:
- `open: boolean`
- `onClose: () => void`
- `onConfirm: () => void`
- `title: string`
- `description: React.ReactNode` (allows rich content like bold counts)
- `confirmText: string` (what user must type, e.g., "12" or "DELETE")
- `confirmLabel?: string` (button text, defaults to "Confirm")
- `isLoading?: boolean`
- `variant?: 'danger' | 'warning' | 'default'` (controls button color: red for danger, yellow for warning, purple for default)

Implementation:
- Use Headless UI Dialog (same pattern as existing ConfirmationModal)
- Input field with placeholder showing confirmText
- Button disabled until input exactly matches confirmText (case-sensitive)
- Clear input when modal opens (reset on `open` change)
- Style consistent with existing ConfirmationModal: bg-surface, border-border, text-white
- Danger variant: bg-red-600 hover:bg-red-700 button
- Warning variant: bg-yellow-600 hover:bg-yellow-700 button
- Default variant: bg-accent-purple hover:bg-accent-purple/90 button
- Show "Type {confirmText} to confirm" instruction text in text-gray-400
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>TypeToConfirmModal renders with input validation, disabled button until match, loading state, and three color variants.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- All four new files exist and export their types/components
- Types can be imported in a test: `import { ExportFormat } from '@/types/export'`
- Hook can be imported: `import { useShiftSelection } from '@/hooks/use-selection'`
- Modal can be imported: `import { TypeToConfirmModal } from '@/components/ui/type-to-confirm-modal'`
</verification>

<success_criteria>
- Export types define all formats (CSV, JSON, XLSX), modes (current_view, all), and status tracking
- Bulk operation types cover delete, reassign, and export-selected with partial failure results
- useShiftSelection hook handles single click, shift-click range (using stable IDs, not indices), select-all, and clear
- TypeToConfirmModal requires exact text match before enabling confirm, with danger/warning/default variants
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-management/07-01-SUMMARY.md`
</output>
