---
phase: 07-data-management
plan: 06
type: execute
wave: 3
depends_on: ["07-03", "07-04", "07-05"]
files_modified:
  - src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx
  - src/app/(dashboard)/guilds/[guildId]/posts/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can select accounts via checkboxes with shift-click range selection"
    - "User can select posts via checkboxes with shift-click range selection"
    - "Sticky selection bar appears at bottom when items are selected"
    - "User can trigger bulk delete, export selected, and reassign from selection bar"
    - "Export dropdown appears in filter bar on both pages"
    - "Type-to-confirm modal appears for all bulk operations"
  artifacts:
    - path: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      provides: "Accounts page with selection, bulk operations, and export integration"
      contains: "useShiftSelection"
    - path: "src/app/(dashboard)/guilds/[guildId]/posts/page.tsx"
      provides: "Posts page with selection, bulk operations, and export integration"
      contains: "useShiftSelection"
  key_links:
    - from: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      to: "src/hooks/use-selection.ts"
      via: "useShiftSelection for card selection"
      pattern: "useShiftSelection"
    - from: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      to: "src/hooks/use-bulk-operations.ts"
      via: "useBulkDelete, useBulkReassign mutations"
      pattern: "useBulkDelete"
    - from: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      to: "src/components/bulk/selection-bar.tsx"
      via: "SelectionBar component"
      pattern: "SelectionBar"
    - from: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      to: "src/components/export/export-dropdown.tsx"
      via: "ExportDropdown in filter bar"
      pattern: "ExportDropdown"
---

<objective>
Wire selection, bulk operations, and export into the existing Accounts and Posts pages.

Purpose: This is the core integration plan that makes Phase 7 features accessible to users on their existing data pages. It adds checkboxes to cards, integrates the selection bar, and wires bulk operation flows with type-to-confirm modals.
Output: Updated Accounts and Posts pages with full selection and bulk operation capabilities.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-management/07-CONTEXT.md
@.planning/phases/07-data-management/07-03-SUMMARY.md
@.planning/phases/07-data-management/07-04-SUMMARY.md
@.planning/phases/07-data-management/07-05-SUMMARY.md
@src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx
@src/app/(dashboard)/guilds/[guildId]/posts/page.tsx
@src/hooks/use-selection.ts
@src/hooks/use-bulk-operations.ts
@src/hooks/use-exports.ts
@src/components/tracking/selectable-account-card.tsx
@src/components/tracking/selectable-post-card.tsx
@src/components/bulk/selection-bar.tsx
@src/components/export/export-dropdown.tsx
@src/components/ui/type-to-confirm-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Accounts page with selection and bulk operations</name>
  <files>src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx</files>
  <action>
Modify the existing Accounts page to add selection and bulk operations. Read the current file first, then enhance it.

**New imports:**
- `useShiftSelection` from `@/hooks/use-selection`
- `useBulkDelete, useBulkReassign` from `@/hooks/use-bulk-operations`
- `useCreateExport` from `@/hooks/use-exports`
- `SelectableAccountCard` from `@/components/tracking/selectable-account-card`
- `SelectionBar` from `@/components/bulk/selection-bar`
- `ExportDropdown` from `@/components/export/export-dropdown`
- `TypeToConfirmModal` from `@/components/ui/type-to-confirm-modal`
- `ReassignModal` from `@/components/bulk/reassign-modal`
- `BulkResultsToast` from `@/components/bulk/bulk-results-toast`

**New state:**
- `useShiftSelection(accounts)` — pass the flattened accounts array
- `showDeleteConfirm: boolean` — controls type-to-confirm for bulk delete
- `showReassignModal: boolean` — controls reassign modal
- `showExportConfirm: boolean` — controls type-to-confirm for bulk export
- `bulkResults: BulkOperationResult | null` — stores results for display
- `selectedExportFormat: ExportFormat | null` — selected format for bulk export

**Modifications:**

1. **Filter bar:** Add `ExportDropdown` as the last child inside FilterBar. Pass guildId, a guild name (can derive from a useGuild hook or just use guildId), dataType='accounts', and current filter state. Also add a "Select All" checkbox before the search input that calls `selectAllVisible()` with indeterminate state when partial.

2. **Card grid:** Replace `<AccountCard>` with `<SelectableAccountCard>` for each account. Pass `index`, `selected={selectedIds.has(account.id)}`, and `onSelect={handleSelect}`.

3. **Selection bar:** Add `<SelectionBar>` after ScrollToBottom. Pass selectedCount, dataType='accounts', callbacks for delete/export/reassign, and clear. Pass totalCount from pagination and isAllVisibleSelected from hook.

4. **Bulk delete flow:**
   - SelectionBar's onDelete opens showDeleteConfirm
   - TypeToConfirmModal: title="Delete {selectedCount} accounts", description="This will move {selectedCount} accounts to trash. They can be restored within 30 days.", confirmText=selectedCount.toString(), variant="danger"
   - On confirm: call bulkDelete.mutateAsync({ ids: Array.from(selectedIds), dataType: 'accounts' })
   - On success: set bulkResults, clear selection, close modal
   - On error: show error toast

5. **Bulk reassign flow:**
   - SelectionBar's onReassign opens showReassignModal
   - ReassignModal handles its own brand/group selection and type-to-confirm
   - On confirm: call bulkReassign.mutateAsync with target brand/group
   - On success: set bulkResults, clear selection, close modal

6. **Bulk export flow:**
   - SelectionBar's onExport: use the export create mutation directly, passing selected IDs
   - Simple approach: create export with ids array (backend handles selected-items export)

7. **Results display:** When bulkResults is set, show BulkResultsToast in a fixed position or as an alert above the card grid. Auto-dismiss after 8 seconds or on user click.

8. **Clear selection on filter change:** When filters change, do NOT clear selection (items stay selected even if filtered out — only visible items show checkboxes). Selection bar always shows total selected count.

Keep all existing functionality intact (filters, infinite scroll, add account modal, empty states).
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors. Visually verify the page still renders correctly.</verify>
  <done>Accounts page shows checkboxes on cards, selection bar on selection, export dropdown in filter bar, and type-to-confirm flows for delete and reassign.</done>
</task>

<task type="auto">
  <name>Task 2: Posts page with selection and bulk operations</name>
  <files>src/app/(dashboard)/guilds/[guildId]/posts/page.tsx</files>
  <action>
Same pattern as Task 1 but for the Posts page. Read the current file first.

Key differences from accounts:
- Posts use `url` as identifier (not `id`), so selection IDs are URLs
- No reassign action for posts (per user decision: "Reassign to different group/brand" — applies to accounts only)
- SelectionBar shows only Delete and Export buttons for posts (no Reassign)
- Use `SelectablePostCard` wrapper instead of `SelectableAccountCard`
- Posts have different filter state (includes status, dateRange)
- Export dropdown dataType='posts'

**New imports:** Same as accounts except no ReassignModal.

**Modifications:**
1. Add ExportDropdown in FilterBar
2. Replace PostCard with SelectablePostCard
3. Add SelectionBar with dataType='posts' (onReassign not passed, so reassign button won't show)
4. Bulk delete flow: same as accounts but with dataType='posts'
5. Bulk export flow: same as accounts but with dataType='posts'
6. Results display: same BulkResultsToast pattern

Keep all existing functionality intact (filters, infinite scroll, empty states, date range picker).
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>Posts page shows checkboxes on cards, selection bar with delete and export (no reassign), and export dropdown in filter bar.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- Both pages render without errors
- Selection state tracked correctly (shift-click, single click, select all)
- SelectionBar appears/disappears based on selection count
- Export dropdown appears in filter bar on both pages
- Type-to-confirm modals block action until confirmation text matches
- Bulk results display with success/failure breakdown
</verification>

<success_criteria>
- Accounts page: checkboxes on every card, shift-click range works, sticky bottom bar with Delete/Export/Reassign
- Posts page: checkboxes on every card, shift-click range works, sticky bottom bar with Delete/Export (no Reassign)
- Both pages: ExportDropdown in filter bar with CSV/JSON/XLSX format options
- Type-to-confirm required for delete and reassign operations
- Partial failure results shown via BulkResultsToast
- All existing functionality preserved (filters, infinite scroll, add modal, empty states)
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-management/07-06-SUMMARY.md`
</output>
