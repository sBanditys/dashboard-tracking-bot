---
phase: 03-tracking-data-display
plan: 05
type: execute
wave: 3
depends_on: ["03-02", "03-03", "03-04"]
files_modified:
  - src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx
  - src/app/(dashboard)/guilds/[guildId]/posts/page.tsx
  - src/app/(dashboard)/guilds/[guildId]/brands/page.tsx
autonomous: true

must_haves:
  truths:
    - "Accounts page shows cards with infinite scroll"
    - "Posts page shows cards with infinite scroll"
    - "Filter bar is sticky and contains all filter controls"
    - "Empty list shows EmptyState component"
    - "No results shows NoResults with clear option"
    - "Brands page shows proper empty state"
  artifacts:
    - path: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      provides: "Card-based accounts view with infinite scroll"
      min_lines: 80
    - path: "src/app/(dashboard)/guilds/[guildId]/posts/page.tsx"
      provides: "Card-based posts view with infinite scroll"
      min_lines: 100
    - path: "src/app/(dashboard)/guilds/[guildId]/brands/page.tsx"
      provides: "Brands view with proper empty states"
      min_lines: 60
  key_links:
    - from: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      to: "src/hooks/use-tracking.ts"
      via: "useAccountsInfinite hook"
      pattern: "useAccountsInfinite"
    - from: "src/app/(dashboard)/guilds/[guildId]/posts/page.tsx"
      to: "src/hooks/use-tracking.ts"
      via: "usePostsInfinite hook"
      pattern: "usePostsInfinite"
    - from: "src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx"
      to: "react-intersection-observer"
      via: "useInView for scroll detection"
      pattern: "useInView.*from.*react-intersection-observer"
---

<objective>
Refactor tracking pages to use cards and infinite scroll.

Purpose: Transform the existing table-based accounts and posts pages into the card-based infinite scroll layouts defined in CONTEXT.md. Update brands page with proper empty states.

Output: Fully refactored accounts, posts, and brands pages using new components.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-tracking-data-display/03-CONTEXT.md
@.planning/phases/03-tracking-data-display/03-RESEARCH.md

# Components from prior plans
@src/components/filters/index.ts
@src/components/tracking/index.ts
@src/components/scroll-to-top.tsx
@src/components/empty-state.tsx

# Hooks from prior plans
@src/hooks/use-tracking.ts

# Existing pages to refactor
@src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx
@src/app/(dashboard)/guilds/[guildId]/posts/page.tsx
@src/app/(dashboard)/guilds/[guildId]/brands/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor accounts page</name>
  <files>
    src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx
  </files>
  <action>
Completely refactor src/app/(dashboard)/guilds/[guildId]/accounts/page.tsx:

1. Replace useAccounts with useAccountsInfinite
2. Add react-intersection-observer for scroll detection:
```tsx
import { useInView } from 'react-intersection-observer'

const { ref, inView } = useInView({ threshold: 0, rootMargin: '100px' })

useEffect(() => {
  if (inView && hasNextPage && !isFetchingNextPage) {
    fetchNextPage()
  }
}, [inView, hasNextPage, isFetchingNextPage, fetchNextPage])
```

3. Add filter state with URL params for shareability:
   - search: string
   - platform: string
   - pageSize: number (from localStorage, default 50)

4. Replace DataTable with card grid:
```tsx
<div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
  {accounts.map(account => (
    <AccountCard key={account.id} account={account} />
  ))}
</div>
```

5. Add FilterBar with:
   - SearchInput for search
   - PlatformSelect for platform
   - PageSizeSelect for batch size

6. Handle states:
   - Initial loading: Show AccountCardSkeleton (3x count)
   - Empty (no accounts): Show EmptyState with "No accounts yet"
   - No results (filter matches nothing): Show NoResults with clear option
   - Loading more: Show AccountCardSkeleton below existing cards

7. Add sentinel div with ref at bottom for infinite scroll
8. Add ScrollToTop component
9. Remove old imports (DataTable, Pagination, column definitions)
10. Remove duplicate PlatformIcon (now using shared component)

Layout structure:
```tsx
<div className="space-y-6">
  <header>Title and count</header>
  <GuildTabs />
  <FilterBar>
    <SearchInput />
    <PlatformSelect />
    <PageSizeSelect />
  </FilterBar>
  <div className="grid ...">Cards</div>
  <div ref={ref} /> {/* sentinel */}
  {isFetchingNextPage && <AccountCardSkeleton count={3} />}
  <ScrollToTop />
</div>
```
  </action>
  <verify>
- Cards render in grid layout
- Scrolling near bottom loads more
- Filters work and clear properly
- Empty and no-results states display correctly
  </verify>
  <done>Accounts page uses cards with infinite scroll and filters</done>
</task>

<task type="auto">
  <name>Task 2: Refactor posts page</name>
  <files>
    src/app/(dashboard)/guilds/[guildId]/posts/page.tsx
  </files>
  <action>
Completely refactor src/app/(dashboard)/guilds/[guildId]/posts/page.tsx:

1. Replace usePosts with usePostsInfinite
2. Add react-intersection-observer (same pattern as accounts)

3. Add filter state:
   - search: string
   - platform: string
   - dateRange: DateRange | undefined
   - status: string
   - pageSize: number

4. Replace DataTable with card grid:
```tsx
<div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
  {posts.map(post => (
    <PostCard key={post.url} post={post} />
  ))}
</div>
```

5. Add FilterBar with:
   - SearchInput for search
   - PlatformSelect for platform
   - DateRangePicker for date range
   - Status select (keep as native select or convert to Headless UI)
   - PageSizeSelect

6. Convert date range to API format:
```tsx
const filters = {
  platform,
  status,
  search,
  from: dateRange?.from?.toISOString(),
  to: dateRange?.to?.toISOString(),
}
```

7. Handle states (same as accounts):
   - Initial loading: PostCardSkeleton
   - Empty: EmptyState
   - No results: NoResults
   - Loading more: PostCardSkeleton below cards

8. Add sentinel and ScrollToTop
9. Remove old imports and sorting logic (API handles sorting)
10. Remove duplicate PlatformIcon

Note: Keep status filter as native select OR convert to Headless UI Listbox for consistency (prefer Listbox for accessibility).
  </action>
  <verify>
- Cards render in grid layout
- Date range filter works with calendar
- Platform and status filters work
- Infinite scroll loads more posts
  </verify>
  <done>Posts page uses cards with infinite scroll and full filtering</done>
</task>

<task type="auto">
  <name>Task 3: Update brands page with proper empty states</name>
  <files>
    src/app/(dashboard)/guilds/[guildId]/brands/page.tsx
  </files>
  <action>
Update src/app/(dashboard)/guilds/[guildId]/brands/page.tsx:

1. Keep existing card/expandable structure (already good per CONTEXT.md)
2. Replace basic empty state with EmptyState component:

Before (current):
```tsx
<div className="bg-surface border border-border rounded-sm p-8 text-center">
  <p className="text-gray-400">No brands found for this guild</p>
</div>
```

After:
```tsx
<EmptyState
  icon={<TagIcon />}  // or appropriate icon
  title="No brands yet"
  description="Brands help organize your tracked accounts. They'll appear here once configured."
  action={{
    label: "Learn about brands",
    href: "/docs/brands"  // or appropriate help URL
  }}
/>
```

3. Add inline SVG icon (tag or folder icon) for the empty state
4. Keep the expandable brand cards as-is (they already follow the pattern)
5. Ensure ScrollToTop is included (even though brands typically don't need infinite scroll)

No infinite scroll needed for brands (typically < 20 per guild).
  </action>
  <verify>
- Empty state shows with icon, title, description, action
- Existing brand cards still work with expansion
- Page structure remains consistent with other tracking pages
  </verify>
  <done>Brands page has proper empty state guidance</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - no TypeScript errors
2. Navigate to accounts page - cards render, infinite scroll works
3. Navigate to posts page - cards render, all filters work
4. Navigate to brands page - empty state shows when no brands
5. Test filter combinations - no stale data, proper loading states
</verification>

<success_criteria>
- Accounts show as cards in responsive grid
- Posts show as cards in responsive grid
- FilterBar sticks when scrolling on both pages
- Infinite scroll loads more data on both pages
- EmptyState shows when no data
- NoResults shows when filters match nothing
- Brands page has consistent empty state
- All pages include ScrollToTop
</success_criteria>

<output>
After completion, create `.planning/phases/03-tracking-data-display/03-05-SUMMARY.md`
</output>
