---
phase: 07-data-management
plan: 05
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/export/export-dropdown.tsx
  - src/components/export/export-progress.tsx
  - src/components/bulk/reassign-modal.tsx
autonomous: true

must_haves:
  truths:
    - "User can choose export format (CSV, JSON, XLSX) and mode (current view, all) from a dropdown"
    - "User sees real-time progress bar during large exports"
    - "User can reassign selected accounts to a different brand/group via modal"
  artifacts:
    - path: "src/components/export/export-dropdown.tsx"
      provides: "Export button with dropdown for format and mode selection"
      contains: "ExportDropdown"
    - path: "src/components/export/export-progress.tsx"
      provides: "Progress bar for active exports with cancel option"
      contains: "ExportProgress"
    - path: "src/components/bulk/reassign-modal.tsx"
      provides: "Modal for bulk reassigning accounts to different brand/group"
      contains: "ReassignModal"
  key_links:
    - from: "src/components/export/export-dropdown.tsx"
      to: "src/types/export.ts"
      via: "ExportFormat, ExportMode types"
      pattern: "ExportFormat"
    - from: "src/components/bulk/reassign-modal.tsx"
      to: "src/hooks/use-tracking.ts"
      via: "useBrands for brand/group list"
      pattern: "useBrands"
---

<objective>
Create the export dropdown, export progress bar, and reassign modal components.

Purpose: These are the action components that get triggered from the filter bar (export dropdown) or selection bar (reassign). The export progress component handles the background job UX with real-time updates.
Output: ExportDropdown, ExportProgress, and ReassignModal components.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-management/07-CONTEXT.md
@.planning/phases/07-data-management/07-RESEARCH.md
@.planning/phases/07-data-management/07-01-SUMMARY.md
@src/types/export.ts
@src/types/bulk.ts
@src/types/tracking.ts
@src/hooks/use-tracking.ts
@src/components/ui/type-to-confirm-modal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: ExportDropdown and ExportProgress</name>
  <files>src/components/export/export-dropdown.tsx, src/components/export/export-progress.tsx</files>
  <action>
**`src/components/export/export-dropdown.tsx`:**

Per user decisions:
- Export button on each data page in the filter bar area
- Two modes: "Export current view" and "Export all"
- Three formats: CSV, JSON, XLSX
- User-editable filename with descriptive default

Props:
- `guildId: string`
- `guildName: string` (for default filename generation)
- `dataType: 'accounts' | 'posts'`
- `activeFilters?: Record<string, string>` (current filter state to pass for "current view" exports)
- `onExportStarted?: (exportRecord: ExportRecord) => void` (callback when export begins)

Implementation:
- Use Headless UI Menu component for the dropdown (consistent with DEV-013 pattern)
- Button labeled "Export" with a download icon SVG
- Dropdown shows two sections:

Section 1 - "Export current view" (if filters are active) or just "Export all":
  - CSV
  - JSON
  - XLSX

Section 2 - "Export all" (if filters are active, showing both options):
  - CSV
  - JSON
  - XLSX

When user clicks a format+mode:
1. Show a small inline dialog (or expand within the dropdown) with a text input for filename
2. Default filename: `${guildName.toLowerCase().replace(/\s+/g, '-')}-${dataType}-${new Date().toISOString().split('T')[0]}` (e.g., "sonuhaempire-accounts-2026-02-07")
3. Extension is auto-appended based on format
4. Submit button to start export

Actually, simpler approach: clicking a format+mode opens a small popover/modal with filename field pre-filled with default, format badge, and "Export" button. This avoids nested dropdowns.

Style: Menu items with icons — CSV (table icon), JSON (code icon), XLSX (spreadsheet icon). Group headers in text-xs text-gray-500 uppercase.

**`src/components/export/export-progress.tsx`:**

Per user decisions:
- Progress bar with item count ("Exporting 450/1,200 items...")
- Background exports: toast notification if user is on the page

Props:
- `progress: number` (0-100)
- `status: ExportStatus`
- `recordCount: number`
- `totalCount?: number`
- `message?: string`
- `downloadUrl?: string | null`
- `onDismiss?: () => void`

Layout: compact card (can be used inline on export page or as a toast-like notification).

States:
- **pending/processing:** Show progress bar (bg-accent-purple), item count text "Exporting {recordCount}/{totalCount || '...'} items...", animated pulse on bar
- **completed:** Green bar at 100%, "Export complete" text, "Download" link if downloadUrl is provided. Download link styled as `text-accent-purple hover:underline`.
- **failed:** Red bar, error message text, dismiss button

Progress bar: `h-2 rounded-full bg-border` container with `bg-accent-purple rounded-full transition-all duration-300` fill. Width: `${progress}%`.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>ExportDropdown shows format/mode options with editable filename, ExportProgress shows real-time progress bar with status states.</done>
</task>

<task type="auto">
  <name>Task 2: ReassignModal</name>
  <files>src/components/bulk/reassign-modal.tsx</files>
  <action>
Per user decision: bulk reassign to different group/brand, with type-to-confirm pattern.

Props:
- `open: boolean`
- `onClose: () => void`
- `onConfirm: (targetBrandId: string, targetGroupId?: string) => void`
- `selectedCount: number`
- `guildId: string`
- `isLoading?: boolean`

Implementation:
- Use Headless UI Dialog (consistent pattern)
- Fetch brands using useBrands(guildId) to populate dropdowns
- Two dropdowns:
  1. Brand select (required) — styled select with brand.label options
  2. Group select (optional) — populated from selected brand's groups array. Disabled until brand is selected. Shows "No group" option.

- Below dropdowns: TypeToConfirmModal-like inline confirmation (don't nest modals — instead embed the type-to-confirm pattern directly):
  - Text: "Type {selectedCount} to confirm reassignment"
  - Input field for confirmation
  - Confirm button disabled until input matches count.toString()

- Warning text: "This will reassign {selectedCount} accounts to {selectedBrandLabel}."

- Button: "Reassign {selectedCount} accounts" — bg-accent-purple, disabled until brand selected AND confirmation text matches

Style: Same modal styling as existing ConfirmationModal (bg-surface, border-border, max-w-md).

Brand select styling: `bg-background border border-border rounded-md px-3 py-2 text-white w-full` with option styling.
Group select styling: same, with disabled state `opacity-50 cursor-not-allowed`.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>ReassignModal shows brand/group selection with type-to-confirm, disabled until valid selection and confirmation text match.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- ExportDropdown uses Headless UI Menu with format grouping
- ExportProgress handles all four status states with appropriate visual feedback
- ReassignModal loads brands dynamically, groups update on brand selection
- Type-to-confirm pattern is enforced in ReassignModal
</verification>

<success_criteria>
- ExportDropdown shows CSV/JSON/XLSX options with current-view and all modes
- Default filename follows pattern: guildname-datatype-date
- ExportProgress shows animated progress bar with item counts
- ExportProgress shows download link on completion, error on failure
- ReassignModal requires brand selection + type-to-confirm before enabling action
- All components follow dark theme styling (bg-surface, text-white, border-border)
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-management/07-05-SUMMARY.md`
</output>
