---
phase: 07-data-management
plan: 08
type: execute
wave: 3
depends_on: ["07-03"]
files_modified:
  - src/app/(dashboard)/guilds/[guildId]/settings/trash/page.tsx
  - src/components/trash/trash-item-card.tsx
  - src/components/trash/trash-list.tsx
autonomous: true

must_haves:
  truths:
    - "User can view soft-deleted accounts and posts in the trash page"
    - "User can restore items from trash to their original location"
    - "User can permanently delete items from trash with type-to-confirm"
    - "Trash shows days until auto-purge with warning for items expiring soon"
  artifacts:
    - path: "src/app/(dashboard)/guilds/[guildId]/settings/trash/page.tsx"
      provides: "Trash page under guild settings showing deleted items"
      contains: "TrashPage"
    - path: "src/components/trash/trash-item-card.tsx"
      provides: "Card for a trashed item showing name, type, deletion date, and purge countdown"
      contains: "TrashItemCard"
    - path: "src/components/trash/trash-list.tsx"
      provides: "Filtered list of trashed items with type tabs and actions"
      contains: "TrashList"
  key_links:
    - from: "src/app/(dashboard)/guilds/[guildId]/settings/trash/page.tsx"
      to: "src/hooks/use-trash.ts"
      via: "useTrashItems, useRestoreItem, usePermanentDelete hooks"
      pattern: "useTrashItems"
    - from: "src/components/trash/trash-item-card.tsx"
      to: "src/components/ui/type-to-confirm-modal.tsx"
      via: "TypeToConfirmModal for permanent delete"
      pattern: "TypeToConfirmModal"
---

<objective>
Create the trash management page under guild settings for viewing, restoring, and permanently deleting soft-deleted items.

Purpose: Per user decision, deleted items go to trash (soft delete) and are accessible under guild settings as a "Deleted Items" sub-page. Users can restore items within 30 days or permanently delete them with type-to-confirm.
Output: Trash page, trash item cards, and trash list with type filtering.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-management/07-CONTEXT.md
@.planning/phases/07-data-management/07-RESEARCH.md
@.planning/phases/07-data-management/07-03-SUMMARY.md
@src/hooks/use-trash.ts
@src/components/ui/type-to-confirm-modal.tsx
@src/types/tracking.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: TrashItemCard and TrashList components</name>
  <files>src/components/trash/trash-item-card.tsx, src/components/trash/trash-list.tsx</files>
  <action>
**`src/components/trash/trash-item-card.tsx`:**

Per Claude's discretion on trash UI layout: group by type with tabs, show deletion date and "expires in X days" countdown.

Props:
- `item: TrashItem` (from use-trash.ts — has id, name, type, platform, deletedAt, deletedBy, daysUntilPurge, originalData)
- `onRestore: (itemId: string, dataType: 'accounts' | 'posts') => void`
- `onPermanentDelete: (itemId: string, dataType: 'accounts' | 'posts') => void`
- `isRestoring?: boolean`
- `isDeleting?: boolean`

Layout: bg-surface border border-border rounded-lg p-4, flex row.

Left side (info):
- Platform icon (PlatformIcon component) + item name (text-white font-medium)
- Type badge: "Account" or "Post" in text-xs
- Deleted date: "Deleted {formatDistanceToNow(deletedAt)} ago" in text-sm text-gray-400
- Purge countdown:
  - daysUntilPurge > 7: text-gray-400 "Expires in {daysUntilPurge} days"
  - daysUntilPurge <= 7 and > 0: text-yellow-400 "Expires in {daysUntilPurge} days" with yellow left border
  - daysUntilPurge <= 1: text-red-400 "Expires today" with red left border

Right side (actions):
- "Restore" button: text-accent-purple hover:text-accent-purple/80, shows loading spinner when isRestoring
- "Delete permanently" button: text-red-500 hover:text-red-400, triggers permanent delete flow

**`src/components/trash/trash-list.tsx`:**

Props:
- `guildId: string`

Internal state:
- `activeTab: 'accounts' | 'posts'` — tab filter
- `showPermanentDeleteModal: boolean`
- `itemToDelete: { id: string, name: string, dataType: 'accounts' | 'posts' } | null`

Uses useTrashItems(guildId, activeTab) for data.
Uses useRestoreItem(guildId) and usePermanentDelete(guildId) for mutations.

Layout:
- Tab bar at top: "Accounts" | "Posts" styled as segmented buttons (similar to TimeRangeSelector pattern from DEV-047)
- Active tab: bg-accent-purple text-white, inactive: bg-surface text-gray-400 hover:text-white
- Count badges on tabs showing number of trashed items per type (if available)

Below tabs: list of TrashItemCard components.

Empty state per tab: "No deleted {accounts|posts}. Items you delete will appear here for 30 days before being permanently removed."

Restore flow: call restoreMutation.mutateAsync, show success inline or via brief green text
Permanent delete flow: clicking "Delete permanently" opens TypeToConfirmModal with confirmText="DELETE", variant="danger", title="Permanently delete {item.name}?", description="This action cannot be undone. The item will be permanently removed."

Loading state: show skeleton cards while loading (reuse existing card skeleton pattern).
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>TrashItemCard shows item info with purge countdown and restore/delete actions. TrashList shows filtered tabs with type-to-confirm for permanent delete.</done>
</task>

<task type="auto">
  <name>Task 2: Trash page under guild settings</name>
  <files>src/app/(dashboard)/guilds/[guildId]/settings/trash/page.tsx</files>
  <action>
Create the trash page as a sub-page under the guild settings path.

'use client' page component.

Props: `{ params: { guildId: string } }`

Layout:
- Page header: "Deleted Items" title (h1, text-3xl font-bold text-white)
- Subtitle: "Items deleted from this guild. Automatically purged after 30 days." (text-gray-400)
- GuildTabs for navigation
- Info banner: bg-yellow-500/10 border border-yellow-500/20 rounded-lg p-4 with icon: "Deleted items are kept for 30 days before permanent removal. You can restore items at any time during this period."
- TrashList component with guildId

This page path is: `/guilds/[guildId]/settings/trash`

Per user decision: "Trash accessible under guild settings as 'Deleted Items' sub-page."

Note: The guild overview page already shows GuildSettingsForm. The trash page is a separate route accessible from the settings area. It will be linked from the sidebar in the next plan (07-09) or can be accessed directly. For now, just create the page — linking will be handled in the integration plan.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors. Verify the page file exists at the correct path.</verify>
  <done>Trash page renders at /guilds/[guildId]/settings/trash with header, info banner, and TrashList component showing tabbed view of deleted accounts and posts.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- Trash page exists at correct Next.js route path
- TrashItemCard shows expiry warnings (yellow for <= 7 days, red for <= 1 day)
- TrashList tabs switch between accounts and posts
- Restore and permanent delete flows work with proper mutations
- Type-to-confirm required for permanent deletion (confirmText="DELETE")
</verification>

<success_criteria>
- Trash page at /guilds/[guildId]/settings/trash shows soft-deleted items
- Items grouped by type via tabbed interface (Accounts | Posts)
- Each item shows: name, platform, deletion date, days until purge
- Warning colors for items expiring soon (yellow <= 7 days, red <= 1 day)
- Restore button clears deletedAt and returns item to original location
- Permanent delete requires typing "DELETE" to confirm
- Empty states guide users about the 30-day auto-purge policy
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-management/07-08-SUMMARY.md`
</output>
