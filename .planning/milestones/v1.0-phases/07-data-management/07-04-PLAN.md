---
phase: 07-data-management
plan: 04
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/tracking/selectable-account-card.tsx
  - src/components/tracking/selectable-post-card.tsx
  - src/components/bulk/selection-bar.tsx
  - src/components/bulk/bulk-results-toast.tsx
autonomous: true

must_haves:
  truths:
    - "Account and post cards show checkboxes that respond to click and shift-click"
    - "Sticky bottom bar appears when 1+ items are selected showing count and action buttons"
    - "Bulk operation results display as toast notifications with success/failure breakdown"
  artifacts:
    - path: "src/components/tracking/selectable-account-card.tsx"
      provides: "Account card wrapper with checkbox for selection"
      contains: "SelectableAccountCard"
    - path: "src/components/tracking/selectable-post-card.tsx"
      provides: "Post card wrapper with checkbox for selection"
      contains: "SelectablePostCard"
    - path: "src/components/bulk/selection-bar.tsx"
      provides: "Sticky bottom bar with selected count and action buttons"
      contains: "SelectionBar"
    - path: "src/components/bulk/bulk-results-toast.tsx"
      provides: "Toast component for bulk operation results with partial failure display"
      contains: "BulkResultsToast"
  key_links:
    - from: "src/components/tracking/selectable-account-card.tsx"
      to: "src/components/tracking/account-card.tsx"
      via: "Wraps AccountCard with checkbox"
      pattern: "AccountCard"
    - from: "src/components/bulk/selection-bar.tsx"
      to: "src/hooks/use-selection.ts"
      via: "Receives selectedCount and action callbacks"
      pattern: "selectedCount"
---

<objective>
Create the selection UI components: selectable card wrappers with checkboxes, the sticky selection bar, and bulk results toast.

Purpose: Users need to select items via checkboxes (with shift-click for range), see a persistent action bar showing what they can do, and get feedback on bulk operation outcomes.
Output: Selectable card wrappers, SelectionBar component, BulkResultsToast component.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-management/07-CONTEXT.md
@.planning/phases/07-data-management/07-01-SUMMARY.md
@src/components/tracking/account-card.tsx
@src/components/tracking/post-card.tsx
@src/types/tracking.ts
@src/types/bulk.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Selectable card wrappers</name>
  <files>src/components/tracking/selectable-account-card.tsx, src/components/tracking/selectable-post-card.tsx</files>
  <action>
Create wrapper components that add a checkbox to existing cards WITHOUT modifying the original card components (composition over modification).

**`src/components/tracking/selectable-account-card.tsx`:**

Props:
- `account: Account` (from @/types/tracking)
- `guildId: string`
- `index: number` (position in visible list, for shift-click)
- `selected: boolean`
- `onSelect: (id: string, index: number, event: React.MouseEvent) => void`

Layout: horizontal flex container with:
1. Checkbox (left side) — custom styled checkbox input: `appearance-none w-5 h-5 border-2 border-border rounded bg-surface checked:bg-accent-purple checked:border-accent-purple` with a check SVG overlay when checked. Use `cursor-pointer`. The checkbox click calls `onSelect(account.id, index, event)` — pass the mouse event so shift-click works.
2. AccountCard (takes remaining space) — render the existing AccountCard component as-is

The checkbox area should be a `<div>` with `onClick` handler that stops propagation so clicking the checkbox doesn't expand the card. The checkbox should have `flex-shrink-0` and be vertically centered with `items-center`.

When selected, add a subtle purple left border or background tint: `border-l-2 border-l-accent-purple bg-accent-purple/5`.

**`src/components/tracking/selectable-post-card.tsx`:**

Same pattern but wraps PostCard. Posts use `url` as identifier instead of `id`.

Props:
- `post: Post` (from @/types/tracking)
- `index: number`
- `selected: boolean`
- `onSelect: (id: string, index: number, event: React.MouseEvent) => void`

Uses `post.url` as the item ID for selection.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>Both selectable card wrappers render checkbox + original card, pass mouse events for shift-click, and show visual selection state.</done>
</task>

<task type="auto">
  <name>Task 2: SelectionBar and BulkResultsToast</name>
  <files>src/components/bulk/selection-bar.tsx, src/components/bulk/bulk-results-toast.tsx</files>
  <action>
**`src/components/bulk/selection-bar.tsx`:**

Per user decision: "Sticky bottom bar appears when items are selected showing 'X selected' with action buttons."

Props:
- `selectedCount: number`
- `dataType: 'accounts' | 'posts'`
- `onDelete: () => void`
- `onExport: () => void`
- `onReassign: () => void` (only shown for accounts)
- `onClear: () => void`
- `totalCount?: number` (total items available, for "Select all X items" banner)
- `isAllVisibleSelected?: boolean` (triggers "Select all X items" link)
- `onSelectAll?: () => void` (selects ALL items, not just visible — Gmail pattern)

Render when selectedCount > 0, otherwise return null.

Layout: `fixed bottom-0 left-64 right-0 z-40` (left-64 to avoid sidebar overlap per sidebar width w-64). On mobile: `left-0`.

Inner container: `bg-surface border-t border-border shadow-lg px-6 py-3 flex items-center justify-between`

Left side:
- "X selected" text in `text-white font-medium`
- "Clear selection" button in `text-sm text-gray-400 hover:text-white`

Right side (flex gap-2):
- "Export selected" button: `bg-surface border border-border text-white hover:bg-surface/80 px-4 py-2 rounded-md text-sm`
- "Reassign" button (only if dataType === 'accounts'): same secondary style
- "Delete" button: `bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm`

Above the bar (if isAllVisibleSelected && totalCount && totalCount > selectedCount): Show banner text: "All {selectedCount} items on this page are selected. [Select all {totalCount} items]" — the link calls onSelectAll.

**`src/components/bulk/bulk-results-toast.tsx`:**

Per user decision: "Partial failure handling: show results summary."

Props:
- `results: BulkOperationResult` (from @/types/bulk)
- `operationType: 'deleted' | 'reassigned' | 'exported'`

This is a component that renders inline (not a toast library) — it will be used inside a toast or results modal.

If results.failed === 0: success message in green — "{results.succeeded} items {operationType} successfully"
If results.failed > 0: warning message — "{results.succeeded} {operationType}, {results.failed} failed" with expandable details showing failed item IDs and error messages.

Use text-green-400 for success, text-yellow-400 for partial failure, text-red-400 for all-failed.

Style: compact, designed to fit inside a toast or small panel.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>SelectionBar shows sticky bottom bar with count and actions, BulkResultsToast shows success/partial-failure/failure breakdown.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- SelectableAccountCard and SelectablePostCard wrap original cards with checkbox
- SelectionBar is fixed to bottom, avoids sidebar overlap, shows correct actions per dataType
- BulkResultsToast handles all three states (all success, partial, all failed)
</verification>

<success_criteria>
- Checkboxes on cards pass mouse events for shift-click range selection
- Selected cards show visual distinction (purple border/tint)
- SelectionBar appears at bottom when items selected, shows "X selected" with Delete/Export/Reassign buttons
- Gmail-pattern "Select all X items" link appears when all visible items are selected
- Reassign button only shows for accounts (not posts)
- BulkResultsToast formats partial failure results with expandable error details
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-management/07-04-SUMMARY.md`
</output>
