---
phase: 06-analytics
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/analytics/analytics-chart.tsx
  - src/components/analytics/analytics-chart-skeleton.tsx
  - src/components/analytics/mini-sparkline.tsx
autonomous: true

must_haves:
  truths:
    - "Area chart renders time-series data with gradient fill and dark theme"
    - "Hover tooltip shows exact count and date"
    - "Click on data point triggers navigation callback"
    - "Mini sparkline renders compact chart without axes"
  artifacts:
    - path: "src/components/analytics/analytics-chart.tsx"
      provides: "AnalyticsChart area chart component"
      exports: ["AnalyticsChart"]
    - path: "src/components/analytics/analytics-chart-skeleton.tsx"
      provides: "Loading skeleton for chart"
      exports: ["AnalyticsChartSkeleton"]
    - path: "src/components/analytics/mini-sparkline.tsx"
      provides: "Compact sparkline for overview"
      exports: ["MiniSparkline"]
  key_links:
    - from: "src/components/analytics/analytics-chart.tsx"
      to: "recharts"
      via: "AreaChart, Area, XAxis, YAxis imports"
      pattern: "import.*recharts"
---

<objective>
Build the main area chart and mini sparkline visualization components using Recharts.

Purpose: The area chart is the core visual feature of the analytics page — user specifically requested a "weekly submission graph" that feels like a core feature. The mini sparkline provides a compact preview for the guild overview page.
Output: AnalyticsChart with tooltips and click navigation, AnalyticsChartSkeleton, and MiniSparkline components.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-analytics/06-RESEARCH.md (Recharts patterns, custom tooltip, sparkline examples)

Reference existing patterns:
@src/components/ui/skeleton.tsx (Skeleton component)
@src/lib/utils.ts (cn utility)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnalyticsChart area chart with tooltip and click navigation</name>
  <files>src/components/analytics/analytics-chart.tsx, src/components/analytics/analytics-chart-skeleton.tsx</files>
  <action>
    1. Create `src/components/analytics/analytics-chart.tsx`:

    Import from recharts: `AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer`

    Props interface:
    ```typescript
    interface AnalyticsChartProps {
      data: Array<{ date: string; count: number; rawDate: string }>
      granularity: 'day' | 'week'
      onDataPointClick?: (rawDate: string) => void
      className?: string
    }
    ```

    Implementation:
    - Wrapper div: `bg-surface border border-border rounded-sm p-6` with `className` merge via cn
    - Title: "Submissions" in `text-lg font-semibold text-white mb-4`
    - Chart container: Parent div with `h-[300px]` (explicit height per research pitfall 5)
    - `<ResponsiveContainer width="100%" height="100%">`
    - `<AreaChart data={data}>` with onClick handler that extracts activeLabel and calls onDataPointClick with the rawDate
    - Gradient definition:
      ```tsx
      <defs>
        <linearGradient id="colorCount" x1="0" y1="0" x2="0" y2="1">
          <stop offset="5%" stopColor="#8b5cf6" stopOpacity={0.8} />
          <stop offset="95%" stopColor="#8b5cf6" stopOpacity={0} />
        </linearGradient>
      </defs>
      ```
    - `<CartesianGrid strokeDasharray="3 3" stroke="#333" />`
    - `<XAxis dataKey="date" stroke="#9ca3af" tick={{ fontSize: 12 }} />`
    - `<YAxis stroke="#9ca3af" tick={{ fontSize: 12 }} allowDecimals={false} />`
    - Custom Tooltip component (inline or separate):
      - Dark theme: `bg-surface border border-border rounded-sm p-3 shadow-lg`
      - Shows date label in `text-sm font-semibold text-white`
      - Shows count: `${payload[0].value} posts ${granularity === 'week' ? 'this week' : 'on this day'}`
      - Only render when `active && payload?.length`
    - `<Area type="monotone" dataKey="count" stroke="#8b5cf6" fillOpacity={1} fill="url(#colorCount)" />`

    **Empty state:** If data is empty or all counts are 0, show a centered message instead of the chart:
    - "No submissions data for this period"
    - `text-gray-400 text-sm` centered within the h-[300px] container
    - This fulfills success criterion #4: "Graphs render correctly with zero data"

    **Click handler:** When user clicks a data point in the AreaChart:
    - Get the clicked entry's rawDate from the data array using the activeLabel index
    - Call `onDataPointClick?.(rawDate)` — the parent page will handle navigation to posts filtered by that date

    Add `'use client'` directive at top (recharts needs client-side rendering).

    2. Create `src/components/analytics/analytics-chart-skeleton.tsx`:
    - Container: `bg-surface border border-border rounded-sm p-6`
    - Skeleton line for title (h-6 w-48 mb-4)
    - Chart area simulation: `h-[300px] flex items-end gap-2`
    - 12 skeleton bars with varying heights using `style={{ height: '${percent}%' }}` where percent cycles through [40, 60, 30, 75, 50, 85, 45, 70, 55, 80, 35, 65] for visual variety
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Verify recharts imports resolve.</verify>
  <done>AnalyticsChart renders area chart with purple gradient, dark theme tooltip, and click-to-navigate. Empty state shows message when no data. Skeleton matches chart dimensions.</done>
</task>

<task type="auto">
  <name>Task 2: Create MiniSparkline component for guild overview</name>
  <files>src/components/analytics/mini-sparkline.tsx</files>
  <action>
    Create `src/components/analytics/mini-sparkline.tsx`:

    Import from recharts: `AreaChart, Area, ResponsiveContainer`

    Props interface:
    ```typescript
    interface MiniSparklineProps {
      data: Array<{ value: number }>
      className?: string
    }
    ```

    Implementation:
    - `'use client'` directive
    - No axes, no grid, no tooltip — purely decorative inline chart
    - `<ResponsiveContainer width="100%" height={40}>`
    - `<AreaChart data={data} margin={{ top: 0, right: 0, left: 0, bottom: 0 }}>`
    - `<Area type="monotone" dataKey="value" stroke="#8b5cf6" fill="#8b5cf6" fillOpacity={0.3} strokeWidth={2} />`

    If data is empty or has fewer than 2 points, render nothing (return null).

    This is a compact preview chart that shows recent trend without detail. It will be placed on the guild overview page inside a clickable card.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors.</verify>
  <done>MiniSparkline renders compact 40px tall area chart. Returns null when insufficient data.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- AnalyticsChart imports recharts correctly
- Custom tooltip has dark theme styling
- Empty state renders when data array is empty
- MiniSparkline renders without axes
</verification>

<success_criteria>
Chart components ready for page assembly. Area chart supports click navigation and dark theme. Mini sparkline provides compact overview preview.
</success_criteria>

<output>
After completion, create `.planning/phases/06-analytics/06-03-SUMMARY.md`
</output>
