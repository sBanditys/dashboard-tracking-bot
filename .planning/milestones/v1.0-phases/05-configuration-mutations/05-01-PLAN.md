---
phase: 05-configuration-mutations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/confirmation-modal.tsx
  - src/hooks/use-guilds.ts
  - src/hooks/use-tracking.ts
  - src/app/api/guilds/[guildId]/accounts/[accountId]/route.ts
  - src/app/api/guilds/[guildId]/brands/[brandId]/route.ts
autonomous: true

must_haves:
  truths:
    - "Confirmation modal displays item name before deletion"
    - "Delete mutations invalidate correct query caches"
    - "Red delete button signals destructive action"
  artifacts:
    - path: "src/components/ui/confirmation-modal.tsx"
      provides: "Reusable delete confirmation dialog"
      min_lines: 40
    - path: "src/hooks/use-guilds.ts"
      provides: "useDeleteAccount, useDeleteBrand mutations"
      exports: ["useDeleteAccount", "useDeleteBrand"]
    - path: "src/app/api/guilds/[guildId]/accounts/[accountId]/route.ts"
      provides: "DELETE endpoint for accounts"
      exports: ["DELETE"]
    - path: "src/app/api/guilds/[guildId]/brands/[brandId]/route.ts"
      provides: "DELETE endpoint for brands"
      exports: ["DELETE"]
  key_links:
    - from: "src/hooks/use-guilds.ts"
      to: "/api/guilds/:guildId/accounts/:accountId"
      via: "fetch DELETE in useDeleteAccount"
      pattern: "method:\\s*['\"]DELETE['\"]"
    - from: "src/hooks/use-guilds.ts"
      to: "queryClient.invalidateQueries"
      via: "cache invalidation on success"
      pattern: "invalidateQueries"
---

<objective>
Create the confirmation modal component and delete mutation hooks for accounts and brands.

Purpose: Establish the foundation for all destructive actions in Phase 5. The confirmation modal is reused across delete flows, and the mutation hooks demonstrate the cache invalidation pattern for all future mutations.

Output: Reusable ConfirmationModal component, useDeleteAccount/useDeleteBrand hooks, and proxy routes for DELETE operations.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-configuration-mutations/05-CONTEXT.md
@.planning/phases/05-configuration-mutations/05-RESEARCH.md

# Existing patterns to follow
@src/hooks/use-guilds.ts
@src/hooks/use-tracking.ts
@src/components/filters/status-select.tsx
@src/app/api/guilds/[guildId]/accounts/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Confirmation Modal Component</name>
  <files>src/components/ui/confirmation-modal.tsx</files>
  <action>
Create a reusable confirmation modal using Headless UI Dialog. Follow these specifications:

**Props interface:**
- open: boolean
- onClose: () => void
- onConfirm: () => void
- title: string (e.g., "Delete Account")
- itemName: string (per CONTEXT.md: show just the item name)
- isLoading?: boolean
- confirmLabel?: string (default: "Delete")

**Implementation:**
- Use `Dialog`, `DialogPanel`, `DialogTitle`, `Description` from @headlessui/react
- Dark backdrop with bg-black/60
- Centered DialogPanel with max-w-md, bg-surface, border-border rounded-lg
- Title in text-lg font-semibold text-white
- Description shows "Are you sure you want to delete {itemName}?" with itemName highlighted in text-white font-medium
- Two buttons: Cancel (text-gray-300 hover:text-white) and Confirm (bg-red-600 hover:bg-red-700 per CONTEXT.md: red for destructive)
- Confirm button shows "Deleting..." when isLoading and is disabled
- Use cn() from @/lib/utils for class merging
- z-50 for proper stacking

Do NOT use Transition wrapper (Headless UI v2 uses built-in transitions with data attributes).
  </action>
  <verify>
File exists at src/components/ui/confirmation-modal.tsx. TypeScript compilation passes: `npx tsc --noEmit`.
  </verify>
  <done>
ConfirmationModal component exported with proper Headless UI Dialog, dark styling, and red confirm button.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Delete API Proxy Routes</name>
  <files>
src/app/api/guilds/[guildId]/accounts/[accountId]/route.ts
src/app/api/guilds/[guildId]/brands/[brandId]/route.ts
  </files>
  <action>
Create DELETE endpoint proxy routes following the existing pattern in accounts/route.ts.

**For accounts/[accountId]/route.ts:**
- Type RouteParams = { params: Promise<{ guildId: string; accountId: string }> }
- Export async function DELETE(request: NextRequest, { params }: RouteParams)
- Extract token from cookies, return 401 if missing
- Forward DELETE to `${API_URL}/api/v1/guilds/${guildId}/accounts/${accountId}`
- Return response status and body from backend
- Catch errors and return 500 with "Failed to delete account"

**For brands/[brandId]/route.ts:**
- Same pattern with brandId instead of accountId
- Forward to `${API_URL}/api/v1/guilds/${guildId}/brands/${brandId}`
- Error message: "Failed to delete brand"

Use the exact cookie/auth pattern from existing routes. Import NextRequest, NextResponse, and cookies.
  </action>
  <verify>
Files exist. TypeScript compilation passes: `npx tsc --noEmit`. Directory structure: src/app/api/guilds/[guildId]/accounts/[accountId]/route.ts and src/app/api/guilds/[guildId]/brands/[brandId]/route.ts
  </verify>
  <done>
DELETE proxy routes exist for both accounts and brands, following existing auth pattern.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Delete Mutation Hooks</name>
  <files>src/hooks/use-guilds.ts</files>
  <action>
Add useDeleteAccount and useDeleteBrand mutation hooks to the existing use-guilds.ts file.

**useDeleteAccount(guildId: string):**
```typescript
export function useDeleteAccount(guildId: string) {
  const queryClient = useQueryClient()

  return useMutation({
    mutationFn: async (accountId: string) => {
      const response = await fetch(`/api/guilds/${guildId}/accounts/${accountId}`, {
        method: 'DELETE',
      })
      if (!response.ok) {
        const error = await response.json()
        throw new Error(error.message || 'Failed to delete account')
      }
      return response.json()
    },
    onSuccess: () => {
      // Invalidate accounts list (both paginated and infinite)
      queryClient.invalidateQueries({ queryKey: ['guild', guildId, 'accounts'] })
      // Invalidate guild details (account counts)
      queryClient.invalidateQueries({ queryKey: ['guild', guildId] })
    },
  })
}
```

**useDeleteBrand(guildId: string):**
- Same pattern, route is `/api/guilds/${guildId}/brands/${brandId}`
- Invalidate ['guild', guildId, 'brands'] and ['guild', guildId]

Import useMutation from @tanstack/react-query (useQueryClient is already imported).
  </action>
  <verify>
TypeScript compilation passes: `npx tsc --noEmit`. Hooks are exported from use-guilds.ts.
  </verify>
  <done>
useDeleteAccount and useDeleteBrand hooks added with proper cache invalidation on success.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes without errors
2. ConfirmationModal renders (can verify import works in a simple test)
3. API routes exist at correct paths
4. Hooks are importable: `import { useDeleteAccount, useDeleteBrand } from '@/hooks/use-guilds'`
</verification>

<success_criteria>
- ConfirmationModal component exists with Headless UI Dialog, red confirm button, loading state
- DELETE proxy routes exist for accounts and brands
- useDeleteAccount and useDeleteBrand hooks exist with cache invalidation
- All TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-configuration-mutations/05-01-SUMMARY.md`
</output>
