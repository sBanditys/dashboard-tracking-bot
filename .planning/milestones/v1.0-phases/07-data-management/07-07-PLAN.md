---
phase: 07-data-management
plan: 07
type: execute
wave: 3
depends_on: ["07-03", "07-05"]
files_modified:
  - src/app/(dashboard)/guilds/[guildId]/exports/page.tsx
  - src/components/export/export-history-table.tsx
  - src/components/export/export-config-form.tsx
  - src/components/layout/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Dedicated export page accessible from sidebar"
    - "User can configure and trigger exports from the export page"
    - "Export history shows previous exports with download links"
    - "Sidebar shows Export link in guild-specific navigation"
  artifacts:
    - path: "src/app/(dashboard)/guilds/[guildId]/exports/page.tsx"
      provides: "Full export page with configuration form and history table"
      contains: "ExportsPage"
    - path: "src/components/export/export-history-table.tsx"
      provides: "Table displaying export history with status, download links, and metadata"
      contains: "ExportHistoryTable"
    - path: "src/components/export/export-config-form.tsx"
      provides: "Form for configuring and triggering exports"
      contains: "ExportConfigForm"
    - path: "src/components/layout/sidebar.tsx"
      provides: "Updated sidebar with Exports link"
      contains: "Exports"
  key_links:
    - from: "src/app/(dashboard)/guilds/[guildId]/exports/page.tsx"
      to: "src/hooks/use-exports.ts"
      via: "useCreateExport, useExportHistory hooks"
      pattern: "useCreateExport|useExportHistory"
    - from: "src/components/layout/sidebar.tsx"
      to: "/guilds/[guildId]/exports"
      via: "Link component"
      pattern: "exports"
---

<objective>
Create the dedicated export page with configuration form, export history table, and add Exports link to sidebar.

Purpose: Per user decision, the dashboard has a dedicated export page in the sidebar for full configuration and export history. This is separate from the inline export dropdown on data pages â€” it provides full control over export settings, custom filenames, and access to all past exports with download links.
Output: Exports page, export history table, export config form, updated sidebar.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-data-management/07-CONTEXT.md
@.planning/phases/07-data-management/07-03-SUMMARY.md
@.planning/phases/07-data-management/07-05-SUMMARY.md
@src/components/layout/sidebar.tsx
@src/types/export.ts
@src/hooks/use-exports.ts
@src/components/export/export-dropdown.tsx
@src/components/export/export-progress.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: ExportConfigForm and ExportHistoryTable</name>
  <files>src/components/export/export-config-form.tsx, src/components/export/export-history-table.tsx</files>
  <action>
**`src/components/export/export-config-form.tsx`:**

Props:
- `guildId: string`
- `guildName: string`
- `onExportStarted?: (exportRecord: ExportRecord) => void`

Form fields:
1. **Data type** â€” radio buttons or segmented control: "Accounts" | "Posts"
2. **Format** â€” radio buttons styled as cards: CSV (with file icon), JSON (with code icon), XLSX (with spreadsheet icon). Active state: `border-accent-purple bg-accent-purple/10`
3. **Mode** â€” toggle: "Export all data" vs "Export current view (with filters)"
4. **Filename** â€” text input with default value following the pattern `{guildName}-{dataType}-{date}`. Extension auto-appended and shown as a suffix badge (`.csv`, `.json`, `.xlsx`). Input styled: `bg-background border border-border rounded-md px-3 py-2 text-white`

Submit button: "Start Export" â€” bg-accent-purple, disabled while loading.

When submitted:
- Call useCreateExport mutation
- Pass to onExportStarted callback
- Show inline ExportProgress component below the form while export is in progress

Style: bg-surface border border-border rounded-lg p-6 with section headers in text-lg font-semibold text-white.

**`src/components/export/export-history-table.tsx`:**

Props:
- `guildId: string`

Uses useExportHistory hook internally.

Table columns:
- **Filename** â€” text-white font-medium, truncate if long
- **Type** â€” "Accounts" or "Posts" badge
- **Format** â€” CSV/JSON/XLSX badge with subtle background color per format
- **Status** â€” badge: pending (gray), processing (yellow animated pulse), completed (green), failed (red)
- **Records** â€” count of exported records (or "-" if null)
- **Date** â€” relative time using date-fns formatDistanceToNow (e.g., "2 hours ago")
- **Action** â€” Download link (if completed and downloadUrl present) or "â€”"

Empty state: "No exports yet. Create your first export above."

Pagination: simple prev/next if multiple pages.

Style: bg-surface border border-border rounded-lg. Table rows: `border-b border-border last:border-0 hover:bg-surface/50`. Responsive: on mobile, stack columns vertically or use a card layout instead of table.

Auto-refresh: refetchInterval of 5000ms when any export has pending/processing status (to update completion status). Use the exports array to check if any are active.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors.</verify>
  <done>ExportConfigForm renders full export configuration with format cards and editable filename, ExportHistoryTable shows past exports with status badges and download links.</done>
</task>

<task type="auto">
  <name>Task 2: Exports page and sidebar link</name>
  <files>src/app/(dashboard)/guilds/[guildId]/exports/page.tsx, src/components/layout/sidebar.tsx</files>
  <action>
**`src/app/(dashboard)/guilds/[guildId]/exports/page.tsx`:**

'use client' page component.

Props: `{ params: { guildId: string } }`

Layout:
- Page header: "Exports" title, "Export and download your tracking data" subtitle
- GuildTabs component for navigation consistency
- ExportConfigForm section (top)
- Active export progress section (middle) â€” shows ExportProgress for any in-flight export. Track activeExportId in state. When ExportConfigForm triggers an export, set activeExportId. ExportProgress shows until completed/failed.
- Export History section (bottom) â€” ExportHistoryTable

Use useGuild(guildId) to get guildName for the config form.

**Update `src/components/layout/sidebar.tsx`:**

Read the current sidebar first. Add an "Exports" link to the guild-specific navigation section (the section that already has Activity and Analytics links).

Add after the Analytics link:
```tsx
<Link
  href={`/guilds/${guildId}/exports`}
  onClick={onNavigate}
  className={cn(
    'flex items-center gap-3 px-3 py-2 rounded-sm text-sm font-medium transition-colors',
    pathname.includes('/exports')
      ? 'bg-accent-purple text-white'
      : 'text-gray-300 hover:bg-surface/50 hover:text-white'
  )}
>
  <span className="text-lg">ðŸ“¥</span>
  Exports
</Link>
```

Place it after Analytics and before the closing fragment. This follows the established pattern exactly.
  </action>
  <verify>Run `npx tsc --noEmit` from dashboard root. No type errors. Verify sidebar link exists by reading the file.</verify>
  <done>Exports page renders with config form + active progress + history table. Sidebar shows "Exports" link in guild navigation that highlights when active.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- Exports page at /guilds/[guildId]/exports renders correctly
- ExportConfigForm shows data type, format, mode, and filename fields
- ExportHistoryTable shows past exports with download links
- Sidebar shows Exports link with correct active state
- Active export progress tracks in-flight exports
</verification>

<success_criteria>
- Dedicated export page accessible via sidebar "Exports" link
- Export config form lets user choose data type, format (CSV/JSON/XLSX), mode, and edit filename
- Default filename follows pattern: guildname-datatype-date.ext
- Export history table shows all past exports with status badges and download links
- Active export shows real-time progress bar with item counts
- History auto-refreshes when exports are in progress
</success_criteria>

<output>
After completion, create `.planning/phases/07-data-management/07-07-SUMMARY.md`
</output>
