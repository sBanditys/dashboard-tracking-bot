---
phase: 03-tracking-data-display
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/hooks/use-tracking.ts
  - src/components/scroll-to-top.tsx
autonomous: true

must_haves:
  truths:
    - "Accounts load more data when scrolling near bottom"
    - "Posts load more data when scrolling near bottom"
    - "Filter changes reset to first page of results"
    - "Scroll-to-top button appears after scrolling down"
  artifacts:
    - path: "src/hooks/use-tracking.ts"
      provides: "Infinite query hooks for accounts and posts"
      exports: ["useAccountsInfinite", "usePostsInfinite", "useBrands", "useAccounts", "usePosts"]
    - path: "src/components/scroll-to-top.tsx"
      provides: "Floating button to scroll to page top"
      exports: ["ScrollToTop"]
  key_links:
    - from: "src/hooks/use-tracking.ts"
      to: "@tanstack/react-query"
      via: "useInfiniteQuery import"
      pattern: "import.*useInfiniteQuery.*from.*@tanstack/react-query"
    - from: "src/components/scroll-to-top.tsx"
      to: "window.scrollTo"
      via: "scroll behavior"
      pattern: "window\\.scrollTo"
---

<objective>
Create infinite scroll hooks and scroll-to-top component for tracking data.

Purpose: Replace page-based queries with infinite scroll for accounts and posts. Add scroll-to-top button that appears when user scrolls down. These enable the infinite scroll UX defined in CONTEXT.md.

Output: useAccountsInfinite/usePostsInfinite hooks in use-tracking.ts, ScrollToTop component.
</objective>

<execution_context>
@/Users/gabrielleal/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gabrielleal/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-tracking-data-display/03-CONTEXT.md
@.planning/phases/03-tracking-data-display/03-RESEARCH.md

# Existing hooks to extend
@src/hooks/use-tracking.ts

# Types for accounts and posts
@src/types/tracking.ts

# API routes structure
@src/app/api/guilds/[guildId]/accounts/route.ts
@src/app/api/guilds/[guildId]/posts/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add useAccountsInfinite hook</name>
  <files>
    src/hooks/use-tracking.ts
  </files>
  <action>
Add useAccountsInfinite to src/hooks/use-tracking.ts (keep existing hooks):

1. Import useInfiniteQuery from @tanstack/react-query

2. Create useAccountsInfinite hook:
   - Parameters: guildId, limit (default 50), search filter, platform filter
   - Uses useInfiniteQuery with proper React Query v5 syntax
   - initialPageParam: 1
   - getNextPageParam: return undefined when page >= total_pages
   - Include filters in queryKey for cache invalidation
   - staleTime: 2 minutes (per DEV-002)
   - Pattern from 03-RESEARCH.md Pattern 1

Interface:
```typescript
interface AccountFilters {
  search?: string
  platform?: string
}

export function useAccountsInfinite(
  guildId: string,
  limit: number = 50,
  filters: AccountFilters = {}
)
```

QueryKey structure: ['guild', guildId, 'accounts', 'infinite', limit, filters]

Return includes: data, fetchNextPage, hasNextPage, isFetchingNextPage, isLoading, isError
  </action>
  <verify>
- Hook compiles without TypeScript errors
- Calling fetchNextPage increments page parameter
- Changing filters resets query to page 1
  </verify>
  <done>useAccountsInfinite hook ready for accounts page</done>
</task>

<task type="auto">
  <name>Task 2: Add usePostsInfinite hook</name>
  <files>
    src/hooks/use-tracking.ts
  </files>
  <action>
Add usePostsInfinite to src/hooks/use-tracking.ts:

1. Create usePostsInfinite hook:
   - Parameters: guildId, limit, filters (extended PostFilters)
   - Uses useInfiniteQuery
   - Builds query string from filters (reuse buildPostQuery helper)
   - initialPageParam: 1
   - getNextPageParam: return undefined when page >= total_pages
   - Include filters in queryKey for cache invalidation
   - staleTime: 1 minute (posts update more frequently)

Extended filters interface (add search):
```typescript
interface PostFiltersExtended extends PostFilters {
  search?: string
}
```

Function signature:
```typescript
export function usePostsInfinite(
  guildId: string,
  limit: number = 50,
  filters: PostFiltersExtended = {}
)
```

QueryKey structure: ['guild', guildId, 'posts', 'infinite', limit, filters]
  </action>
  <verify>
- Hook compiles without TypeScript errors
- Filter changes (platform, date range, search) trigger new queries
- getNextPageParam returns undefined at end of pagination
  </verify>
  <done>usePostsInfinite hook ready for posts page</done>
</task>

<task type="auto">
  <name>Task 3: Create ScrollToTop component</name>
  <files>
    src/components/scroll-to-top.tsx
  </files>
  <action>
Create src/components/scroll-to-top.tsx:

1. Track scroll position with useEffect and scroll event listener
2. Show button when scrollY > 300px (threshold from RESEARCH.md)
3. Smooth scroll behavior when clicked
4. Position: fixed bottom-6 right-6
5. Styling: bg-surface, border-border, rounded-full, shadow-lg
6. Arrow up icon (inline SVG)
7. Hover state: bg-background
8. Focus ring for accessibility (focus:ring-2 focus:ring-accent-purple)
9. aria-label="Scroll to top"

Pattern from 03-RESEARCH.md Code Examples:
```tsx
export function ScrollToTop() {
  const [isVisible, setIsVisible] = useState(false)

  useEffect(() => {
    const toggleVisibility = () => {
      setIsVisible(window.scrollY > 300)
    }
    window.addEventListener('scroll', toggleVisibility)
    return () => window.removeEventListener('scroll', toggleVisibility)
  }, [])

  const scrollToTop = () => {
    window.scrollTo({ top: 0, behavior: 'smooth' })
  }

  if (!isVisible) return null

  return (
    <button onClick={scrollToTop} ...>
      <ArrowUpIcon />
    </button>
  )
}
```
  </action>
  <verify>
- Button hidden when at top of page
- Button appears after scrolling past 300px
- Clicking button smoothly scrolls to top
  </verify>
  <done>ScrollToTop component provides navigation aid for long lists</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - no TypeScript errors
2. useAccountsInfinite and usePostsInfinite export correctly
3. ScrollToTop responds to scroll events
4. Infinite hooks properly handle pagination end
</verification>

<success_criteria>
- useAccountsInfinite fetches paginated accounts with filters
- usePostsInfinite fetches paginated posts with filters
- Both hooks return hasNextPage false at end of data
- Filter changes reset pagination
- ScrollToTop appears at 300px scroll, hidden at top
- Smooth scroll behavior works
</success_criteria>

<output>
After completion, create `.planning/phases/03-tracking-data-display/03-03-SUMMARY.md`
</output>
